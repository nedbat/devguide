<?xml version="1.0" encoding="UTF-8"?>
<svg
    xmlns="http://www.w3.org/2000/svg"
    class="release-cycle-chart"
    viewBox="0 0 {{ diagram_width * SCALE }} {{ diagram_height * SCALE }}"
>

    {% for version in versions %}
        {% set y = loop.index * LINE_HEIGHT %}

        {% if loop.index % 2 %}
            <!-- Row shading -->
            <rect
                class="release-cycle-row-shade"
                x="0em"
                y="{{ (y - 1.125) * SCALE }}"
                width="{{ diagram_width * SCALE }}"
                height="{{ LINE_HEIGHT * SCALE }}"
            />
        {% endif %}
    {% endfor %}

    {% for year in years %}
        <text
            class="release-cycle-year-text"
            x="{{ (year_to_x(year) + year_to_x(year + 1)) / 2 * SCALE }}"
            y="{{ (diagram_height - LINE_HEIGHT) * SCALE }}"
            font-size="{{ SCALE * 0.75 }}"
            text-anchor="middle"
        >
            {{ format_year(year) }}
        </text>
        {% if not loop.last %}
        <line
            class="release-cycle-year-line"
            x1="{{ year_to_x(year + 1) * SCALE }}"
            x2="{{ year_to_x(year + 1) * SCALE }}"
            y1="0"
            y2="{{ (diagram_height - LINE_HEIGHT) * SCALE }}"
            font-size="{{ SCALE }}"
        />
        {% endif %}
    {% endfor %}

    {% for version in versions %}
        {% set y = loop.index * LINE_HEIGHT %}

        <!-- Legend on the left -->
        <text
            class="release-cycle-version-label"
            x="{{ 0.5 * SCALE }}"
            y="{{ y * SCALE }}"
            font-size="{{ SCALE }}"
        >
            Python {{ version.key }}
        </text>

        <!-- Colourful blob with a label -->
        {% set start_x = date_to_x(version.first_release_date) %}
        {% set end_x = date_to_x(version.end_of_life_date) %}

        <!-- bugfix status needs a security tail.
            Draw the rectangle with two path elements instead.
            Thanks Claude.ai for the conversion.
        -->
        {% set half_x = [end_x, date_to_x(version.start_security_date)]|min %}
        {% set height = 1.25 * SCALE %}
        {% set left_width = (half_x - start_x) * SCALE %}
        {% set right_width = (end_x - half_x) * SCALE %}
        {% set left_x = start_x * SCALE %}
        {% set middle_x = half_x * SCALE %}
        {% set right_x = half_x * SCALE %}
        {% set recty = (y - 1) * SCALE %}
        {% set radius_value = 0.25 * SCALE %}

        <path
            class="release-cycle-blob release-cycle-status-bugfix"
            d="
                M{{ left_x + radius_value }},{{ recty }}
                q{{ -radius_value }},0 {{ -radius_value }},{{ radius_value }}
                v{{ height - 2*radius_value }}
                Q{{ left_x }},{{ recty + height }} {{ left_x + radius_value }},{{ recty + height }}
                H{{ middle_x }}
                V{{ recty }}
                Z
            "
        />

        {% if version.key != "3.0" %}
        <path
            class="release-cycle-blob release-cycle-status-security"
            d="
                    M{{ right_x }},{{ recty }}
                    H{{ right_x + right_width - radius_value }}
                    Q{{ right_x + right_width }},{{ recty }} {{ right_x + right_width }},{{ recty + radius_value }}
                    V{{ recty + height - radius_value }}
                    Q{{ right_x + right_width }},{{ recty + height }} {{ right_x + right_width - radius_value }},{{ recty + height }}
                    H{{ middle_x }}
                    V{{ recty }}
                    Z
            "
        />
        {% endif %}
        <rect
            class="release-cycle-border release-cycle-status-{{ version.status }}"
            x="{{ start_x * SCALE }}"
            y="{{ (y - 1) * SCALE }}"
            width="{{ (end_x - start_x) * SCALE }}"
            height="{{ 1.25 * SCALE }}"
            rx="0.25em"
            ry="0.25em"
        />
        {% if version.status == "bugfix" %}
        <text
            class="release-cycle-blob-label release-cycle-status-bugfix"
            x="{{ (start_x + half_x) / 2 * SCALE }}"
            y="{{ (y - 0.1) * SCALE }}"
            font-size="{{ SCALE * 0.75 }}"
            text-anchor="middle"
        >
            bugfix
        </text>
        {% elif version.status == "security" %}
        <text
            class="release-cycle-blob-label release-cycle-status-security"
            x="{{ (half_x + end_x) / 2 * SCALE }}"
            y="{{ (y - 0.1) * SCALE }}"
            font-size="{{ SCALE * 0.75 }}"
            text-anchor="middle"
        >
            security
        </text>
        {% elif version.status == "end-of-life" %}
        <text
            class="release-cycle-blob-label release-cycle-status-end-of-life"
            x="{{ (end_x + 0.5) * SCALE }}"
            y="{{ (y - 0.1) * SCALE }}"
            font-size="{{ SCALE * 0.75 }}"
            text-anchor="start"
        >
            end-of-life
        </text>
        {% elif version.status == "feature" %}
        <text
            class="release-cycle-blob-label release-cycle-status-feature"
            x="{{ (start_x - 0.5) * SCALE }}"
            y="{{ (y - 0.1) * SCALE }}"
            font-size="{{ SCALE * 0.75 }}"
            text-anchor="end"
        >
            feature
        </text>
        {% endif %}
        <rect
            class="release-cycle-shade release-cycle-status-{{ version.status }}"
            x="{{ start_x * SCALE }}"
            y="{{ (y - 1) * SCALE }}"
            width="{{ (end_x - start_x) * SCALE }}"
            height="{{ 1.25 * SCALE }}"
            rx="0.25em"
            ry="0.25em"
        />
        <rect
            class="release-cycle-border release-cycle-status-{{ version.status }}"
            x="{{ start_x * SCALE }}"
            y="{{ (y - 1) * SCALE }}"
            width="{{ (end_x - start_x) * SCALE }}"
            height="{{ 1.25 * SCALE }}"
            rx="0.25em"
            ry="0.25em"
        />
    {% endfor %}

    <!-- A line for today -->
    <line
        class="release-cycle-today-line"
        x1="{{ date_to_x(today) * SCALE }}"
        x2="{{ date_to_x(today) * SCALE }}"
        y1="0"
        y2="{{ (diagram_height - LINE_HEIGHT) * SCALE }}"
        font-size="{{ SCALE }}"
    />
</svg>
